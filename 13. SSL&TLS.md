Need to look at the video again and make diagrams for bettern understanding.
--- 


Few things about SSL and TLS : 

SSL (Secure Sockets Layer) is the predecessor to TLS (Transport Layer Security).
SSL (Secure Sockets Layer): Invented by Netscape in the mid-1990s. The final version was SSL 3.0.
TLS (Transport Layer Security): When the Internet Engineering Task Force (IETF) took over development, they renamed it to TLS 1.0 to signify the transition to an open standard.
All versions of SSL are now considered insecure and have been disabled in modern web browsers and servers. TLS is the secure protocol in use today. When someone says "SSL," they are almost certainly referring to TLS.

# Manage TLS Certificates In a Kubernetes Cluster


### Tls in Kubernetes 

![image](https://github.com/user-attachments/assets/340139b0-e5db-4e28-91eb-96cf6cedc44b)

### Client-Server model

![image](https://github.com/user-attachments/assets/316de6e9-491e-4b89-af06-0b5fe2059f4f)

### How certs are loaded

![image](https://github.com/user-attachments/assets/adf2c877-c8b0-4e87-948f-f1f78ef25e27)

### Where we use certs in control plane components

![image](https://github.com/user-attachments/assets/ec9fd842-9a25-4138-afb4-930876adb8b8)



---

Questions : Let's say a new engineer just joined and we need to give him an admin , how can we do this using kubernetes certificate ? 

We can grant a new SRE engineer admin access using a Kubernetes-issued certificate, but it's generally not the preferred method for human users in modern production clusters.

This approach bypasses external Identity Providers (IdP) and relies on Kubernetes' internal PKI (Public Key Infrastructure) to authenticate the user.

Steps : 

1. Generate Key Pair and Certificate Signing Request (CSR)

```
  # SRE runs this locally
  openssl genrsa -out sre-admin.key 2048
  openssl req -new -key sre-admin.key -out sre-admin.csr -subj "/CN=sre-new-user/O=system:masters"
  ```
2. Create the Kubernetes CSR Resource

   Go to the .csr file and using ``` cat sre-admin.csr | base64 | tr -d '\n' ```

   create csr yaml file

```
  apiVersion: certificates.k8s.io/v1
  kind: CertificateSigningRequest
  metadata:
    name: adam
  spec:
    request: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1ZEQ0NBVHdDQVFBd0R6RU5NQXNHQTFVRUF3d0VZV1JoYlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRApnZ0VQQURDQ0FRb0NnZ0VCQUpESDFGWWFnZHpoR3JDK04yQ1A5RDEzcEc2VHhaMm0yTjdYeWFaSkRUSUs1aEFlCk9kSDdmbE1uYzVUQm1TZFRoK21zaXZjWm1xOU85VmRLYzk5MVczM1J6eUV3ZDZsUHZGY2Y5cUcyTmtOUTZzOFcKaUJ1dnVjMlRMU25hUVRETTVqZUlPR3FkZTVxajM4eVZUdmlLMHpSR0dOMDZMWjdsYVNnN2w2MEtZUlIzWVc3OQpOZUFDcUZJRnFyTFBRN09EdTNLZ2lvMTFmdFdXUlRFVkVLOW02dWhKRy9CcERsUzVjaUhXTmRiMlBEVW1aRlY2CllvT2dGRHhvNkhwUS8rUXlUVFJhWTJYc1IvVXl3cWswSklWNmRjVUVPZUp4QzRVQlI0TFQrOXNwS09TcXVoMGIKMHcveGdIL0RjYUlScVlFVDJhTHBYS1Rja1RENEhjQzE1VzBxM2ZjQ0F3RUFBYUFBTUEwR0NTcUdTSWIzRFFFQgpDd1VBQTRJQkFRQmZPMWhUR0RJNFN5d2tMRXZLMmdPbDNsRzdRd1FyKy94MXg4dmpOVTRHWnN6ajJPeHVWaWpnCllsUG5yV2FXN3ZBeXdlNGhmMGZnNmZwRWM0THB0MmZTWWhWZlNvVXBha2lud0RqU2JaYi9qL2VIdzRyUWhHb2sKZ0p0THpmcEY3b0RUQTJrVFB1TythWWNvd0FlWlQ1R2gxdmFZYWJZZXUvbnFoZit3RmVCTTNmZ1JPS0JCOW9jWQo3dmxWRmZnczVjQmNWbEtNdkE3ZWlGWUluSWVUK3BZT3kyd1hSeGd3bkxWaGdlb3dlRnRVK05LRXV5QkJDaVJpCk9QSFM1cTdJTmREQUl4eDd4ZmVLUUhsQ0hvME1zQ2NWYTluaUh6djhZTzR1MDQxSDZTcnRTTHNVRmRQY2FjL0sKWENsYVU3NldkZVhQMDJLTjNFUEZ4UkVudGJ0Qlk5M3IKLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tCg==
    signerName: kubernetes.io/kube-apiserver-client
    usages:
    - client auth
```
```
kubectl apply -f csr.yaml
```
```
NAME   AGE   SIGNERNAME                            REQUESTOR          REQUESTEDDURATION   CONDITION
adam   69s   kubernetes.io/kube-apiserver-client   kubernetes-admin   <none>              Pending
```


3. Approve the CSR

   ```kubectl certificate approve adam```

   
   
4. Retrieve the signed certificate

   How ?
   kubect get csr adam -o yaml > issuecert.yaml

   
   
```
   apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"certificates.k8s.io/v1","kind":"CertificateSigningRequest","metadata":{"annotations":{},"name":"adam"},"spec":{"request":"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1ZEQ0NBVHdDQVFBd0R6RU5NQXNHQTFVRUF3d0VZV1JoYlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRApnZ0VQQURDQ0FRb0NnZ0VCQUpESDFGWWFnZHpoR3JDK04yQ1A5RDEzcEc2VHhaMm0yTjdYeWFaSkRUSUs1aEFlCk9kSDdmbE1uYzVUQm1TZFRoK21zaXZjWm1xOU85VmRLYzk5MVczM1J6eUV3ZDZsUHZGY2Y5cUcyTmtOUTZzOFcKaUJ1dnVjMlRMU25hUVRETTVqZUlPR3FkZTVxajM4eVZUdmlLMHpSR0dOMDZMWjdsYVNnN2w2MEtZUlIzWVc3OQpOZUFDcUZJRnFyTFBRN09EdTNLZ2lvMTFmdFdXUlRFVkVLOW02dWhKRy9CcERsUzVjaUhXTmRiMlBEVW1aRlY2CllvT2dGRHhvNkhwUS8rUXlUVFJhWTJYc1IvVXl3cWswSklWNmRjVUVPZUp4QzRVQlI0TFQrOXNwS09TcXVoMGIKMHcveGdIL0RjYUlScVlFVDJhTHBYS1Rja1RENEhjQzE1VzBxM2ZjQ0F3RUFBYUFBTUEwR0NTcUdTSWIzRFFFQgpDd1VBQTRJQkFRQmZPMWhUR0RJNFN5d2tMRXZLMmdPbDNsRzdRd1FyKy94MXg4dmpOVTRHWnN6ajJPeHVWaWpnCllsUG5yV2FXN3ZBeXdlNGhmMGZnNmZwRWM0THB0MmZTWWhWZlNvVXBha2lud0RqU2JaYi9qL2VIdzRyUWhHb2sKZ0p0THpmcEY3b0RUQTJrVFB1TythWWNvd0FlWlQ1R2gxdmFZYWJZZXUvbnFoZit3RmVCTTNmZ1JPS0JCOW9jWQo3dmxWRmZnczVjQmNWbEtNdkE3ZWlGWUluSWVUK3BZT3kyd1hSeGd3bkxWaGdlb3dlRnRVK05LRXV5QkJDaVJpCk9QSFM1cTdJTmREQUl4eDd4ZmVLUUhsQ0hvME1zQ2NWYTluaUh6djhZTzR1MDQxSDZTcnRTTHNVRmRQY2FjL0sKWENsYVU3NldkZVhQMDJLTjNFUEZ4UkVudGJ0Qlk5M3IKLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tCg==","signerName":"kubernetes.io/kube-apiserver-client","usages":["client auth"]}}
  creationTimestamp: "2025-10-27T18:58:20Z"
  name: adam
  resourceVersion: "302732"
  uid: 06386a90-5331-412b-b4d4-dfbdcf643587
spec:
  extra:
    authentication.kubernetes.io/credential-id:
    - X509SHA256=98fe0e63cdeedabec5b0d98e9e9c034c44bebb665ad2d8252ac623a3602ae0d6
  groups:
  - kubeadm:cluster-admins
  - system:authenticated
  request: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1ZEQ0NBVHdDQVFBd0R6RU5NQXNHQTFVRUF3d0VZV1JoYlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRApnZ0VQQURDQ0FRb0NnZ0VCQUpESDFGWXN3ZBeXdlNGhmMGZnNmZwRWM0THB0MmZTWWhWZlNvVXBha2lud0RqU2JaYi9qL2VIdzRyUWhHb2sKZ0p0THpmcEY3b0RUQTJrVFB1TythWWNvd0FlWlQ1R2gxdmFZYWJZZXUvbnFoZit3RmVCTTNmZ1JPS0JCOW9jWQo3dmxWRmZnczVjQmNWbEtNdkE3ZWlGWUluSWVUK3BZT3kyd1hSeGd3bkxWaGdlb3dlRnRVK05LRXV5QkJDaVJpCk9QSFM1cTdJTmREQUl4eDd4ZmVLUUhsQ0hvME1zQ2NWYTluaUh6djhZTzR1MDQxSDZTcnRTTHNVRmRQY2FjL0sKWENsYVU3NldkZVhQMDJLTjNFUEZ4UkVudGJ0Qlk5M3IKLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tCg==
  signerName: kubernetes.io/kube-apiserver-client
  usages:
  - client auth
  username: kubernetes-admin
status:
  certificate: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM5VENDQWQyZ0F3SUJBZ0lSQUxXMWdrMFFJNDF4bkwxcEtjaytiR3N3RFFZSktvWklodmNOQVFFTEJRQXcKRlRFVE1CRUdBMVVFQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzdGplMThtbVNRMHlDdVlRSGpuUiszNVQKSjNPVXdaa25VNGZwcklyM0dacXZUdlZYU25QZmRWdDkwYzhoTUhlcFQ3eFhIL2FodGpaRFVPclBGb2dicjduTgpreTBwMmtFd3pPWTNpRGhxblh1YW85L01snCmRMZzVtcSt1b3k2LzNIM1MzQ2QrM2Z1Wk9UWlI2cUtGZ1BHRTdrM1JPN0NyRWNycUV3bEdobitEb21CYlFmLzcKWTdId0liZ25MNGlLUEcrRmpWdFdMb2cwNTdmSEtjaEZrVVhaekZqbnFuTFQxTEMxU3AzSEpFWnFWb1ZEd2x5TgpZM3I5MUx0d1BUQnBJSjZLeXhCdk1wMEhWUVJyNUVFRVErN0dEL2lIRFJKU2RLdGY3KzFzUXZmSFQ3SktMUFpyCkNtQnp4Mk00RzBXSkQvZ1BYaUwxUlpDUHUzRGpMdjJYVkt5djBZdGZHNXdBL21GM24yT2k2clE9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  conditions:
  - lastTransitionTime: "2025-10-27T19:00:03Z"
    lastUpdateTime: "2025-10-27T19:00:03Z"
    message: This CSR was approved by kubectl certificate approve.
    reason: KubectlApprove
    status: "True"
    type: Approved
```

Now under this file we haave the certificate that is issue under the parameter : "certificate", we need to decode it to base64


```


echo "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM5VENDQWQyZ0F3SUJBZ0lSQUxXMWdrMFFJNDF4bkwxcEtjaytiR3N3RFFZSktvWklodmNOQVFFTEJRQXcKRlRFVE1CRUdBMVVFQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzdGplMThtbVNRMHlDdVlRSGpuUiszNVQKSjNPVXdaa25VNGZwcklyM0dacXZUdlZYU25QZmRWdDkwYzhoTUhlcFQ3eFhIL2FodGpaRFVPclBGb2dicjduTgpreTBwMmtFd3pPWTNpRGhxblh1YW85L01snCmRMZzVtcSt1b3k2LzNIM1MzQ2QrM2Z1Wk9UWlI2cUtGZ1BHRTdrM1JPN0NyRWNycUV3bEdobitEb21CYlFmLzcKWTdId0liZ25MNGlLUEcrRmpWdFdMb2cwNTdmSEtjaEZrVVhaekZqbnFuTFQxTEMxU3AzSEpFWnFWb1ZEd2x5TgpZM3I5MUx0d1BUQnBJSjZLeXhCdk1wMEhWUVJyNUVFRVErN0dEL2lIRFJKU2RLdGY3KzFzUXZmSFQ3SktMUFpyCkNtQnp4Mk00RzBXSkQvZ1BYaUwxUlpDUHUzRGpMdjJYVkt5djBZdGZHNXdBL21GM24yT2k2clE9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K" | base 64 -d

```

5. imortant point 
   login to the control plane node :  docker exec -it multi-node-cluster-control-plane bash
   /# cd /etc/kubernetes/pkiv -- this is where all th certificate file resides
   


