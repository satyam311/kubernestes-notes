# Health Probes 
--- 
Kubernetes uses Probes to check the health and readiness of containers running inside a Pod. This ensures that the application is running correctly and only ready Pods receive traffic.

## There are three type of probes : 


| Probe Name | Purpose | Action on Failure |
| :--- | :--- | :--- |
| **Liveness Probe** | Determines if the container is **running and healthy** (i.e., not deadlocked or crashed). | The **Kubelet restarts the container.** |
| **Readiness Probe** | Determines if the container is **ready to serve traffic** and accept requests. | The **Kubelet removes the Pod from the Service's Endpoints** (it stops receiving traffic). |
| **Startup Probe** | Determines if the application within the container has **successfully finished starting up** (useful for slow-starting apps). | The **Kubelet restarts the container.** If this probe is configured, it disables Liveness and Readiness checks until it succeeds. |

---

### Key Concepts üîë

* **Liveness:** If this probe fails, Kubernetes assumes the container is in an unrecoverable state and kills it, hoping a fresh restart will fix the issue.
* **Readiness:** If this probe fails, the container is still running but is temporarily marked as unavailable. It is only brought back into rotation (added to Service Endpoints) once the probe succeeds again.
* **Interaction:** If a **Startup Probe** is defined, it runs first. The **Liveness** and **Readiness** probes are ignored until the Startup Probe reports success.
---
# Sample YAML

## Define a liveness command

```
apiVersion: v1
kind: Pod
metadata:
  name: liveness-test-pod
  labels: 
    test: livesness
spec:
  containers: 
  - name: liveness-container
    image: registry.k8s.io/busybox:1.27.2
    command: ['sh','-c']
    args: ['touch /tmp/healthy; sleep 30; rm -f /tmp/healthy; sleep 600']
    livenessProbe: 
      exec: 
        command: 
        - cat 
        - /tmp/healthy
      initialDelaySeconds: 5
      periodSeconds: 5

```
```
kubectl apply -f liveness.yaml
kubectl describe live
```

## Define a liveness HTTP request 

```
apiVersion: v1
kind: Pod
metadata:
  labels:
    test: liveness
  name: liveness-http
spec:
  containers:
  - name: liveness
    image: registry.k8s.io/e2e-test-images/agnhost:2.40
    args:
    - liveness
    livenessProbe:
      httpGet:
        path: /healthz
        port: 8080
        httpHeaders:
        - name: Custom-Header
          value: Awesome
      initialDelaySeconds: 3
      periodSeconds: 3
```
```
kubectl apply -f liveness-http.yaml
kubectl describe liveness-http
```

We can change the port the application is listening on : 

```

apiVersion: v1
kind: Pod
metadata:
  name: http-liveness-pod-5000
  labels:
    app: healthy-check
spec:
  containers:
  - name: liveness-container
    image: registry.k8s.io/e2e-test-images/agnhost:2.40
    args: 
    - liveness
    - --port=5000       # ‚¨ÖÔ∏è 1. Change the application's listening port to 5000
    ports:
    - containerPort: 5000 # (Optional, but good practice)
    livenessProbe:
      httpGet:
        path: /healthz
        port: 5000        # ‚¨ÖÔ∏è 2. Change the Liveness Probe's target port to 5000
      initialDelaySeconds: 3
      periodSeconds: 3
```
## Define a TCP liveness probe

```
apiVersion: v1
kind: Pod
metadata:
  name: goproxy
  labels:
    app: goproxy
spec:
  containers:
  - name: goproxy
    image: registry.k8s.io/goproxy:0.1
    ports:
    - containerPort: 8080
    readinessProbe:
      tcpSocket:
        port: 8080
      initialDelaySeconds: 15
      periodSeconds: 10
    livenessProbe:
      tcpSocket:
        port: 8080
      initialDelaySeconds: 15
      periodSeconds: 10
```




