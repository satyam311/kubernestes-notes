### What is a daemonset?
- A daemon set is another type of Kubernetes object that controls pods. Unlike deployment, the DS automatically deploys 1 pod to each available node. You don't need to update the replica based on demand; the DS takes care of it by spinning X number of pods for X number of nodes.
- If you create a ds in a cluster of 5 nodes, then 5 pods will be created.
- If you add another node to the cluster, a new pod will be automatically created on the new node.

### Examples of daemonset
- kube-proxy
- calico
- weave-net
- monitoring agents etc

### Daemonset for a 3 nodes cluster

![image](https://github.com/piyushsachdeva/CKA-2024/assets/40286378/bb803dc2-f9ab-4fe3-a0bb-0eacdfcf3ce0)

k8s documentation: https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/

### DaemonSet yaml example : 
```
apiVersion: apps/v1
kind: DaemonSet
metadata: 
  name: demo-ds
  labels: # given to the pod created by the daemonSet 
    k8s-app: ds-pod-logging
spec:
  #replicas: 3 # we do not need to specify this for daemonset
  selector:
    matchLabels: # Defines which Pods belong to this DaemonSet (selector).
      name: logging-pod 
  template:
    metadata:
      labels: # Labels applied to the Pods created by this DaemonSet. These must match the selector.
        name: logging-pod 
    spec:
      containers:
      - name: ds-container-nginx
        image: nginx:alpine
        ports:
        - containerPort: 80

```

```vim kind-example-multi-node-clsuter-config.yaml```
```
# three node (two workers) cluster config
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
- role: worker
```

```
kind create cluster --config kind-example-multi-node-clsuter-config.yaml --name=multi-node-cluster
kubectl config get-contexts
kubectl config use-context kind-multi-node-cluster
kubectl  get nodes
```
kubectl create -f daemonset.yaml  
kubectl get ds       

NAME      DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
demo-ds   2         2         2       2            2           <none>          4m1s





